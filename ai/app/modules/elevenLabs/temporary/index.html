<!DOCTYPE html>
<html lang="en">
<head>
    <title>Audio Test</title>
    <style> body { font-family: sans-serif; text-align: center; padding-top: 100px; } button { font-size: 1.5rem; padding: 15px 30px; } p { font-size: 1.2rem; } </style>
</head>
<body>
    <h1>Orchestration Demo</h1>
    <button id="getAudioBtn">Get Story Audio</button>
    <p id="status">Click the button to start.</p>
    <script>
        document.getElementById('getAudioBtn').addEventListener('click', async () => {
            const statusEl = document.getElementById('status');
            const btn = document.getElementById('getAudioBtn');
            btn.disabled = true;
            statusEl.textContent = 'Requesting audio from main backend...';

            const response = await fetch('http://127.0.0.1:8001/get-story-audio', { method: 'POST' });

            if (!response.ok) {
                statusEl.textContent = 'Error receiving audio.';
                btn.disabled = false;
                return;
            }

            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const audioData = await response.arrayBuffer();
            const audioBuffer = await audioContext.decodeAudioData(audioData);
            const source = audioContext.createBufferSource();
            source.buffer = audioBuffer;
            source.connect(audioContext.destination);
            
            statusEl.textContent = 'Playing...';
            source.start(0);

            source.onended = () => {
                statusEl.textContent = 'Finished.';
                btn.disabled = false;
            };
        });
    </script>
</body>
</html>